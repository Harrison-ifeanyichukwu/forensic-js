/**
 *@module InputDriver
 *@memberof EventDrivers
*/

/**
 * event initialization options.
 *@typedef {Object} InputEventInit
 *@private
 *@property {boolean} [bubbles=true] - boolean value indicating if event bubbles
 *@property {boolean} [cancelable=false] - boolean value indicating if event is
 * cancelable
 *@property {WindowProxy} [view=null] - identifies the window from which the event was generated.
 *@property {number} [detail=0] - value is initialized to a number that is
 * application-specific.
 *@property {string} [data=''] - data holds the value of the characters
 *@property {boolean} [isComposing=false] - indicates if the event being
 * constructed occurs as part of a composition sequence
 * generated by an input method
*/
import {createDOMEvent, onInstall, host} from '../../Globals.js';
import UIDriver from './UIDriver.js';
import InputEventPollyfill from '../Pollyfills/InputEventPollyfill.js';

/**
 * input event driver class
 *@memberof EventDrivers.InputDriver#
 *@see {@link https://www.w3.org/TR/uievents/#events-inputevents| W3C.org}
*/
export default class InputDriver extends UIDriver {
    /**
     * event types in the input event interface
     *@memberof EventDrivers.InputDriver
     *@type {Array}
    */
    static get events() {
        return ['beforeinput', 'input'];
    }

    /**
     * event init keys
     *@memberof EventDrivers.InputDriver
     *@type {Array}
    */
    static get eventInitKeys() {
        let keys = UIDriver.eventInitKeys;

        keys.push('data', 'isComposing');
        return keys;
    }

    /**
     * initializes the event according to the InputEvent interface eventInit requirement
     *@memberof EventDrivers.InputDriver
     *@param {Object} storeIn - object in which to store initializations
     *@param {InputEventInit} getFrom - event initialization objects
     *@returns {Object}
    */
    static initEvent(storeIn, getFrom) {
        UIDriver.initEvent(storeIn, getFrom);

        storeIn.data = typeof getFrom.data !== 'undefined'? getFrom.data.toString() : '';
        storeIn.isComposing = getFrom.isComposing? true : false;

        return storeIn;
    }

    /**
     * creates a InputEvent object that can be dispatched to an event target
     *@memberof EventDrivers.InputDriver
     *@param {string} type - the event type
     *@param {InputEventInit} eventInit - event initialization object
     *@returns {InputEvent}
    */
    static create(type, eventInit) {
        return createDOMEvent(
            'InputEvent', type, this.initEvent({}, eventInit), this.eventInitKeys
        );
    }

    /**
     *@param {Event} event - the dispatched event object
    */
    constructor(event) {
        super(event);
    }

    /**
     *@memberof EventDrivers.InputDriver#
     *@private
     *@type {string}
    */
    get [Symbol.toStringTag]() {
        return 'InputDriver';
    }

    /**
     * data holds the value of the characters generated by an input method
     *@memberof EventDrivers.InputDriver#
     *@type {string}
    */
    get data() {
        return this.event.data;
    }

    /**
     * true if the input event occurs as part of a composition session, i.e., after a
     * compositionstart event and before the corresponding compositionend event
     *@memberof EventDrivers.InputDriver#
     *@type {boolean}
    */
    get isComposing() {
        return this.event.isComposing;
    }
}

/* install pollyfill */
onInstall(function() {
    InputEventPollyfill.install(host, InputDriver.initEvent);
});